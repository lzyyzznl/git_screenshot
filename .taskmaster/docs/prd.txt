# 浏览器录屏插件技术与 UI 布局文档

以下是基于 WXT 框架、Vue 3、Element Plus 和 UnoCSS 的浏览器录屏插件技术架构和 UI 布局设计方案，专注于架构说明和界面布局描述，不包含具体代码实现。

## 技术架构设计

### 核心技术栈选型

- **WXT 框架**：作为下一代 Web 扩展开发框架，提供优秀的开发体验和构建工具。支持文件基础的入口点、热模块替换、TypeScript 支持以及跨浏览器兼容性。框架自动处理 manifest.json 配置，简化 Chrome 和 Firefox 扩展开发流程。
- **Vue 3**：采用 Composition API，提供响应式状态管理和组件化开发模式，适合构建复杂的用户界面和交互逻辑。
- **Element Plus**：作为 Vue 3 生态中的企业级 UI 组件库，提供丰富的预构建组件，如按钮、选择器、开关、进度条等，支持按需导入以减少打包体积，适用于快速构建一致性 UI。
- **UnoCSS**：原子化 CSS 引擎，提供按需生成的样式方案，性能优于传统 CSS 框架，支持自定义主题和快捷方式，与 Vue 3 无缝集成。

### 系统架构组件

插件采用多层架构设计，包含以下核心组件：

- **Popup UI（弹窗界面）**：用户交互入口，用于选择录制模式和配置参数。
- **Content Script（内容脚本）**：注入到网页中，负责录制覆盖层的管理和用户交互事件的处理。
- **Background Script（后台脚本）**：管理全局状态，处理跨标签页通信和权限请求。
- **Recording Overlay（录制覆盖层）**：录制过程中显示的工具栏，支持实时标注和绘图功能。
- **Result Page（结果页面）**：录制完成后在新标签页中展示内容，支持预览、编辑和格式转换。

### 浏览器 API 集成

- **getDisplayMedia API**：用于屏幕、标签页或区域的捕获，支持用户选择录制范围。
- **MediaRecorder API**：处理实时录制，将捕获的媒体流转换为可存储的视频数据。
- **Canvas API**：实现绘图标注功能，支持铅笔、荧光笔等工具的实时绘制。

### 性能优化策略

- **内存管理**：采用分片录制策略，将录制数据按固定大小分片存储，避免长时间录制导致内存溢出。使用智能缓存机制，定期清理不必要的临时数据。
- **CPU 负载控制**：将视频编码和格式转换等高负载任务迁移到 Web Worker 执行，避免阻塞主线程。动态调整录制参数，根据设备性能降低分辨率或帧率。
- **渲染优化**：Canvas 绘图采用离屏渲染和批量更新，减少重绘次数。使用节流机制限制鼠标事件处理频率，提升绘图流畅度。

### 错误处理与容错机制

- **自动恢复**：定期备份录制状态到本地存储，支持浏览器崩溃或插件异常后的会话恢复。
- **优雅降级**：针对权限拒绝、功能不支持或存储不足等情况，提供降级方案，如切换到低质量模式或提示用户重新授权。

## UI 布局设计

### 1. 插件主界面（Popup UI）

**角色与功能**  
用户通过点击浏览器工具栏中的插件图标打开弹窗界面，用于选择录制模式和配置参数。

**布局描述**

- **标题栏**  
  位于弹窗顶部，显示插件名称（如"录屏助手"），字体较大，居中或左对齐。
- **录制模式选择区**  
  位于标题下方，包含三个单选选项：屏幕录制、标签页录制、区域录制，横向或纵向排列。
- **录制参数配置区**  
  包含多个下拉菜单和开关控件，用于设置分辨率（如 1080p/720p/480p）、帧率（如 30fps/24fps/20fps）和音频开关（开/关）。
- **开始录制按钮**  
  位于配置区下方，醒目的大按钮，居中或占满宽度，带有"开始录制"文本，可能显示加载状态。
- **快捷键提示**  
  位于底部，显示结束录制的快捷键说明（如"结束录制快捷键：Ctrl+Shift+E"），字体较小，颜色较浅。

**样式特点**  
使用 Element Plus 的表单组件和按钮组件，保持一致的圆角和阴影效果，主色调为蓝色或绿色，强调"开始录制"按钮。

### 2. 录制工具栏（Recording Overlay）

**角色与功能**  
录制开始后，屏幕上方显示浮动工具栏，用于显示录制状态、提供绘图工具和结束录制操作。

**布局描述**

- **工具栏容器**  
  固定定位于屏幕顶部居中，背景为白色，带有轻微阴影和圆角，宽度适中不遮挡主要内容。
- **录制状态显示区**  
  位于工具栏左侧，包含一个红色闪烁圆点（表示录制中）、录制时长（如"00:00"）和文件大小（如"0.0MB"）。
- **绘图工具区**  
  位于中间，包含一组图标按钮：铅笔、荧光笔、橡皮擦，当前选中的工具高亮显示。
- **颜色选择器**  
  紧邻绘图工具，提供颜色选择面板，支持预定义颜色（如红、绿、蓝等）。
- **撤销/重做按钮**  
  位于颜色选择器右侧，包含两个图标按钮，用于撤销和重做绘图操作，禁用状态下置灰。
- **结束录制按钮**  
  位于工具栏右侧，醒目的红色按钮，带有"结束录制"文本和图标。

**样式特点**  
工具栏使用 UnoCSS 定义快捷样式，确保响应式布局，按钮组使用 Element Plus 的按钮组件，保持一致的交互反馈（如悬停效果）。

### 3. 录制结果页面（Result Page）

**角色与功能**  
录制结束后自动在新标签页中打开，用于预览录制内容、编辑标注和下载/转换文件。

**布局描述**

- **标题区**  
  位于页面顶部，显示"录制完成"或类似标题，字体较大，居中或左对齐。
- **视频预览区**  
  占据页面主要空间，包含一个视频播放器，支持播放、暂停和进度条控制，视频上方覆盖 Canvas 图层显示标注内容。
- **操作按钮区**  
  位于预览区下方，包含三个大按钮：下载 MP4、转换 GIF、重新编辑，横向排列（在小屏幕上可能纵向堆叠）。
- **转换设置区**  
  位于操作按钮下方，使用可折叠面板，展开后显示质量设置（高/中/低）和 GIF 帧率调整滑块（10-30fps）。
- **进度显示区**  
  在转换或下载过程中显示，位于设置区下方，使用进度条展示当前进度，包含状态指示（如成功或失败）。

**样式特点**  
页面整体布局居中，视频播放器带有边框和阴影，按钮使用 Element Plus 的主题色（如蓝色为主操作，绿色为转换），进度条和折叠面板保持一致的 UI 风格。

## 交互逻辑与用户体验

- **Popup UI**：用户选择录制模式和参数后，点击"开始录制"按钮，弹窗关闭，进入录制状态。
- **Recording Overlay**：录制过程中工具栏始终可见，用户可切换绘图工具、选择颜色、撤销操作或结束录制，支持快捷键（如 Ctrl+Shift+E）快速停止。
- **Result Page**：录制结束自动跳转，用户可预览视频和标注，调整转换设置后下载 MP4 或转换为 GIF，进度条实时反馈操作状态。

## 核心功能要求

1. **录制功能**
   - 支持屏幕录制、标签页录制、区域录制三种模式
   - 支持音频录制开关
   - 支持分辨率和帧率配置
   - 实时录制状态显示

2. **绘图标注功能**
   - 铅笔工具
   - 荧光笔工具
   - 橡皮擦工具
   - 颜色选择器
   - 撤销/重做功能

3. **视频处理功能**
   - MP4 格式导出
   - GIF 格式转换
   - 质量设置选项
   - 进度条显示

4. **技术要求**
   - 所有样式使用 UnoCSS 管理，不允许使用原生 CSS
   - 使用 Vue 3 Composition API
   - 使用 Element Plus UI 组件库
   - 基于 WXT 框架开发 